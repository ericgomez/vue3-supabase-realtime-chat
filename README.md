# Vue3 Supabase Realtime Chat

This template should help get you started developing with Vue 3 in Vite.

## Installation of dependencies: (Supabase v1)

Supabase is an open source Firebase alternative providing all the backend features you need to build a product.

```sh
npm install @supabase/supabase-js@1
```

## Install Tailwind CSS

```sh
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

## Configuration required for the Supabase database to work in Real Time.

```shell
-- MESSAGES
create table public.messages (
  id            bigint generated by default as identity primary key,
  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,
  message       text,
  username      text
);
comment on table public.messages is 'Chat messages.';

/**
 * REALTIME SUBSCRIPTIONS
 * Only allow realtime listening on public tables.
 */
begin;
  -- remove the realtime publication
  drop publication if exists supabase_realtime;

  -- re-create the publication but don't enable it for any tables
  create publication supabase_realtime;
commit;

-- add tables to the publication
alter publication supabase_realtime add table public.messages;
```

## Row-Level Security (RLS) in Supabase database

Using Postgres's "Row-Level-Security" policies, we can set rules on what data the anon key is allowed or not allowed to access by default.

#### Enable RLS

`Supabase Dashboard` > `Autenticacion` > `Policies`

## Create new Policies

`Supabase Dashboard` > `Autenticacion` > `Policies` > Select Table > `New Policy`
Policies are easy to understand once you get the hang of them. Each policy is attached to a table, and the policy is executed every time a table is accessed. You can just think of them as adding a WHERE clause to every query.

#### Add select policy to display chat messages

Get messages posted 30 minutes ago so far

- After selecting `New Policy`, add the name and select operation allowed as `SELECT` and add script.

```shell
(inserted_at >= (now() - '00:30:00'::interval))
```

Add policy insert to allow inserting messages

- After selecting `New Policy`, add the name and select operation allowed as `INSERT` and add script.

```shell
true
```

## Project Setup

```sh
npm install
```

### Compile and Hot-Reload for Development

```sh
npm run dev
```

### Compile and Minify for Production

```sh
npm run build
```
